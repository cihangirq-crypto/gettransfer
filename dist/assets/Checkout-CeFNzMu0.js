import{b as v,A as F,a as m,j as e,B as l}from"./index-CNoEBc0e.js";import{u as k,d as w,r as o}from"./router-2lA1gtRA.js";import{Y as z,Z as B,_ as N}from"./ui-pwCvv38W.js";import"./map-BW_WLVrL.js";const L=()=>{const f=k(),p=w(),{user:a}=v(),c=f.state,[g,u]=o.useState(!0),[x,C]=o.useState(!1),[s,h]=o.useState(null),[y,j]=o.useState(null),d=o.useMemo(()=>{if(!c)return null;const t=c.bookingData||c,r=c.offer||null,n=typeof(r==null?void 0:r.offeredPrice)=="number"?r.offeredPrice:typeof(t==null?void 0:t.finalPrice)=="number"?t.finalPrice:void 0,i=typeof(t==null?void 0:t.estimatedPrice)=="number"?t.estimatedPrice:typeof(t==null?void 0:t.basePrice)=="number"?t.basePrice:0;return{...t,customerId:a==null?void 0:a.id,driverId:(t==null?void 0:t.driverId)||(r==null?void 0:r.driverId),status:"accepted",basePrice:i,finalPrice:n??i,extras:{...(t==null?void 0:t.extras)||{},termsAccepted:!0}}},[c,a==null?void 0:a.id]);o.useEffect(()=>{if(!d){p("/");return}let t=!0;return(async()=>{u(!0);try{const r=await fetch(`${F}/bookings/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),n=await r.json();if(!r.ok||!n.success)throw new Error(n.error||"create_failed");t&&h(n.data)}catch{m.error("Rezervasyon oluşturulamadı"),p("/reserve")}finally{t&&u(!1)}})(),()=>{t=!1}},[]);const A=async t=>{if(s){C(!0);try{const r=await fetch(`${F}/bookings/${s.id}/pay`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:s.finalPrice??s.basePrice,method:t})}),n=await r.json();if(!r.ok||!n.success)throw new Error(n.error||"pay_failed");const i=n.data;h(i),j(i.reservationCode||null),m.success("Rezervasyon onaylandı")}catch{m.error("Ödeme/onay başarısız")}finally{C(!1)}}};return d?y?e.jsx("div",{"trae-inspector-start-line":"88","trae-inspector-start-column":"6","trae-inspector-end-line":"108","trae-inspector-end-column":"12","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"min-h-screen bg-gray-50 py-10",children:e.jsx("div",{"trae-inspector-start-line":"89","trae-inspector-start-column":"8","trae-inspector-end-line":"107","trae-inspector-end-column":"14","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"max-w-xl mx-auto px-4",children:e.jsxs("div",{"trae-inspector-start-line":"90","trae-inspector-start-column":"10","trae-inspector-end-line":"106","trae-inspector-end-column":"16","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"bg-white rounded-lg shadow-md border border-gray-200 p-6",children:[e.jsxs("div",{"trae-inspector-start-line":"91","trae-inspector-start-column":"12","trae-inspector-end-line":"94","trae-inspector-end-column":"18","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"flex items-center gap-2 text-green-700",children:[e.jsx(z,{className:"h-6 w-6"}),e.jsx("h1",{"trae-inspector-start-line":"93","trae-inspector-start-column":"14","trae-inspector-end-line":"93","trae-inspector-end-column":"80","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Rezervasyonunuz%20Olu%C5%9Fturuldu%22%2C%22textStartLine%22%3A%2293%22%2C%22textStartColumn%22%3A%2248%22%2C%22textEndLine%22%3A%2293%22%2C%22textEndColumn%22%3A%2275%22%2C%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"text-xl font-bold",children:"Rezervasyonunuz Oluşturuldu"})]}),e.jsxs("div",{"trae-inspector-start-line":"95","trae-inspector-start-column":"12","trae-inspector-end-line":"101","trae-inspector-end-column":"18","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"mt-4",children:[e.jsx("div",{"trae-inspector-start-line":"96","trae-inspector-start-column":"14","trae-inspector-end-line":"96","trae-inspector-end-column":"75","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Rezervasyon%20Kodu%22%2C%22textStartLine%22%3A%2296%22%2C%22textStartColumn%22%3A%2253%22%2C%22textEndLine%22%3A%2296%22%2C%22textEndColumn%22%3A%2269%22%2C%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"text-sm text-gray-600",children:"Rezervasyon Kodu"}),e.jsx("div",{"trae-inspector-start-line":"97","trae-inspector-start-column":"14","trae-inspector-end-line":"97","trae-inspector-end-column":"93","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"mt-1 text-3xl font-bold tracking-wider",children:y}),e.jsx("div",{"trae-inspector-start-line":"98","trae-inspector-start-column":"14","trae-inspector-end-line":"100","trae-inspector-end-column":"20","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Rezervasyonlar%C4%B1m%20ekran%C4%B1nda%20telefon%20do%C4%9Frulamas%C4%B1%20ile%20bu%20kodla%20g%C3%B6r%C3%BCnt%C3%BCleyebilirsiniz.%22%2C%22textStartLine%22%3A%2298%22%2C%22textStartColumn%22%3A%2258%22%2C%22textEndLine%22%3A%22100%22%2C%22textEndColumn%22%3A%2214%22%2C%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"mt-2 text-sm text-gray-600",children:"Rezervasyonlarım ekranında telefon doğrulaması ile bu kodla görüntüleyebilirsiniz."})]}),e.jsxs("div",{"trae-inspector-start-line":"102","trae-inspector-start-column":"12","trae-inspector-end-line":"105","trae-inspector-end-column":"18","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"mt-6 flex gap-2",children:[e.jsx(l,{onClick:()=>p("/reservations"),children:"Rezervasyonlarım"}),e.jsx(l,{variant:"outline",onClick:()=>p("/reserve"),children:"Yeni Rezervasyon"})]})]})})}):e.jsx("div",{"trae-inspector-start-line":"113","trae-inspector-start-column":"4","trae-inspector-end-line":"145","trae-inspector-end-column":"10","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"min-h-screen bg-gray-50 py-10",children:e.jsx("div",{"trae-inspector-start-line":"114","trae-inspector-start-column":"6","trae-inspector-end-line":"144","trae-inspector-end-column":"12","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"max-w-2xl mx-auto px-4",children:e.jsxs("div",{"trae-inspector-start-line":"115","trae-inspector-start-column":"8","trae-inspector-end-line":"143","trae-inspector-end-column":"14","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"bg-white rounded-lg shadow-md border border-gray-200 p-6",children:[e.jsx("h1",{"trae-inspector-start-line":"116","trae-inspector-start-column":"10","trae-inspector-end-line":"116","trae-inspector-end-column":"69","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22%C3%96deme%22%2C%22textStartLine%22%3A%22116%22%2C%22textStartColumn%22%3A%2259%22%2C%22textEndLine%22%3A%22116%22%2C%22textEndColumn%22%3A%2264%22%2C%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"text-2xl font-bold text-gray-900",children:"Ödeme"}),e.jsx("p",{"trae-inspector-start-line":"117","trae-inspector-start-column":"10","trae-inspector-end-line":"117","trae-inspector-end-column":"96","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22%C3%96deme%20y%C3%B6ntemini%20se%C3%A7in%20ve%20rezervasyonu%20onaylay%C4%B1n.%22%2C%22textStartLine%22%3A%22117%22%2C%22textStartColumn%22%3A%2244%22%2C%22textEndLine%22%3A%22117%22%2C%22textEndColumn%22%3A%2292%22%2C%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"text-gray-600 mt-1",children:"Ödeme yöntemini seçin ve rezervasyonu onaylayın."}),g&&e.jsx("div",{"trae-inspector-start-line":"119","trae-inspector-start-column":"23","trae-inspector-end-line":"119","trae-inspector-end-column":"100","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Rezervasyon%20haz%C4%B1rlan%C4%B1yor...%22%2C%22textStartLine%22%3A%22119%22%2C%22textStartColumn%22%3A%2267%22%2C%22textEndLine%22%3A%22119%22%2C%22textEndColumn%22%3A%2294%22%2C%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"mt-6 text-sm text-gray-500",children:"Rezervasyon hazırlanıyor..."}),s&&e.jsxs("div",{"trae-inspector-start-line":"122","trae-inspector-start-column":"12","trae-inspector-end-line":"126","trae-inspector-end-column":"18","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"mt-6 space-y-2 text-sm text-gray-700",children:[e.jsxs("div",{"trae-inspector-start-line":"123","trae-inspector-start-column":"14","trae-inspector-end-line":"123","trae-inspector-end-column":"116","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",children:[e.jsx("strong",{"trae-inspector-start-line":"123","trae-inspector-start-column":"19","trae-inspector-end-line":"123","trae-inspector-end-column":"41","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Rota%3A%22%2C%22textStartLine%22%3A%22123%22%2C%22textStartColumn%22%3A%2227%22%2C%22textEndLine%22%3A%22123%22%2C%22textEndColumn%22%3A%2232%22%2C%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",children:"Rota:"})," ",s.pickupLocation.address," → ",s.dropoffLocation.address]}),e.jsxs("div",{"trae-inspector-start-line":"124","trae-inspector-start-column":"14","trae-inspector-end-line":"124","trae-inspector-end-column":"103","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",children:[e.jsx("strong",{"trae-inspector-start-line":"124","trae-inspector-start-column":"19","trae-inspector-end-line":"124","trae-inspector-end-column":"42","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Tarih%3A%22%2C%22textStartLine%22%3A%22124%22%2C%22textStartColumn%22%3A%2227%22%2C%22textEndLine%22%3A%22124%22%2C%22textEndColumn%22%3A%2233%22%2C%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",children:"Tarih:"})," ",new Date(s.pickupTime).toLocaleString("tr-TR")]}),e.jsxs("div",{"trae-inspector-start-line":"125","trae-inspector-start-column":"14","trae-inspector-end-line":"125","trae-inspector-end-column":"110","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",children:[e.jsx("strong",{"trae-inspector-start-line":"125","trae-inspector-start-column":"19","trae-inspector-end-line":"125","trae-inspector-end-column":"42","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Tutar%3A%22%2C%22textStartLine%22%3A%22125%22%2C%22textStartColumn%22%3A%2227%22%2C%22textEndLine%22%3A%22125%22%2C%22textEndColumn%22%3A%2233%22%2C%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",children:"Tutar:"})," ₺",Number(s.finalPrice??s.basePrice).toFixed(2)]})]}),e.jsxs("div",{"trae-inspector-start-line":"129","trae-inspector-start-column":"10","trae-inspector-end-line":"138","trae-inspector-end-column":"16","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"mt-8 grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs(l,{disabled:!s||x,onClick:()=>A("card"),className:"w-full",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),"Kart ile Öde"]}),e.jsxs(l,{disabled:!s||x,variant:"outline",onClick:()=>A("cash"),className:"w-full",children:[e.jsx(N,{className:"h-5 w-5 mr-2"}),"Nakit ile Öde"]})]}),e.jsx("div",{"trae-inspector-start-line":"140","trae-inspector-start-column":"10","trae-inspector-end-line":"142","trae-inspector-end-column":"16","trae-inspector-file-path":"src/pages/Checkout.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Not%3A%20Kart%20%C3%B6demesi%20%C5%9Fu%20a%C5%9Famada%20demo%20onayd%C4%B1r%3B%20ger%C3%A7ek%20%C3%B6deme%20sa%C4%9Flay%C4%B1c%C4%B1s%C4%B1%20sonra%20entegre%20edilir.%22%2C%22textStartLine%22%3A%22140%22%2C%22textStartColumn%22%3A%2254%22%2C%22textEndLine%22%3A%22142%22%2C%22textEndColumn%22%3A%2210%22%2C%22cwd%22%3A%22%2Fhome%2Fz%2Fmy-project%22%7D",className:"mt-4 text-xs text-gray-500",children:"Not: Kart ödemesi şu aşamada demo onaydır; gerçek ödeme sağlayıcısı sonra entegre edilir."})]})})}):null};export{L as Checkout};
